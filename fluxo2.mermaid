sequenceDiagram
    participant P as Paciente
    participant IA as Clínica Médica (IA)
    participant T as Tools

    %% INÍCIO DO CHAT
    P->>IA: Iniciar chat
    IA->>P: Solicitar CPF
    P->>IA: Informar CPF

    %% CONSULTA / CADASTRO DO CLIENTE
    IA->>T: consultar_cliente(cpf)
    alt Cliente não encontrado
        T-->>IA: null
        IA->>P: Solicitar dados cadastrais
        P->>IA: Nome, sexo
        IA->>T: cadastrar_alterar_cliente(cpf, nome, sexo)
        T-->>IA: {id_usuario}
    else Cliente encontrado
        T-->>IA: {id_usuario, nome}
    end

    %% MENU PRINCIPAL
    IA->>P: Exibir menu de opções

    %% OPÇÃO 1 — MARCAR CONSULTA
    opt Opção 1 - Marcar Consulta
        P->>IA: Seleciona "Marcar Consulta"
        IA->>T: consultar_especialidade_procedimento(especialidade)
        T-->>IA: {id_especialidade, nome}

        IA->>P: Solicitar dia e procedimento
        P->>IA: Dia + Procedimento

        IA->>T: marcar_consulta_procedimento(dia, id_usuario, id_especialidade, id_procedimento)
        T-->>IA: {id_agenda, data, id_especialidade, id_procedimento}

        IA->>P: Consulta agendada com sucesso
    end

    %% OPÇÃO 2 — DESMARCAR CONSULTA
    opt Opção 2 - Desmarcar Consulta
        P->>IA: Seleciona "Desmarcar Consulta"
        IA->>T: consultar_especialidade_procedimento_cliente(id_usuario, dia)
        T-->>IA: {id_agenda, id_especialidade, nome, data}

        IA->>P: Solicitar confirmação do procedimento
        P->>IA: Confirmar id_agenda

        IA->>T: desmarcar_consulta_procedimento(dia, id_agenda)
        T-->>IA: {sucesso: true}

        IA->>P: Consulta desmarcada
    end

    %% OPÇÃO 3 — CONFIRMAR CONSULTA
    opt Opção 3 - Confirmar Consulta
        P->>IA: Seleciona "Confirmar Consulta"
        IA->>T: consultar_especialidade_procedimento_cliente(id_usuario, dia)
        T-->>IA: {id_agenda, id_especialidade, nome, data}

        IA->>P: Solicitar confirmação
        P->>IA: Confirmar id_agenda

        IA->>T: confirmar_consulta_procedimento(id_agenda)
        T-->>IA: {sucesso: true}

        IA->>P: Consulta confirmada
    end

    %% OPÇÃO 4 — CONSULTAR CONSULTAS
    opt Opção 4 - Consultar Consultas
        P->>IA: Seleciona "Consultar Consultas"
        IA->>T: consultar_especialidade_procedimento_cliente(id_usuario, dia)
        T-->>IA: {id_agenda, id_especialidade, nome, data}

        IA->>P: Exibir consultas/procedimentos
    end

    %% ENCERRAMENTO
    IA->>P: Deseja realizar outra operação?
    P-->>IA: Não
    IA->>P: Encerrar chat
